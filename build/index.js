!function(e){var t={};function a(l){if(t[l])return t[l].exports;var r=t[l]={i:l,l:!1,exports:{}};return e[l].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,l){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(a.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(l,r,function(t){return e[t]}.bind(null,r));return l},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){var l=a(1).initializeApp({apiKey:"AIzaSyDZF1-ipAZ81EENp2NtdxRlrq6V7FmWX4s",authDomain:"fir-1-81fde.firebaseapp.com",databaseURL:"https://fir-1-81fde.firebaseio.com",projectId:"fir-1-81fde",storageBucket:"fir-1-81fde.appspot.com",messagingSenderId:"445926783318"}),r=a(2),n=(a(3),{port:1883,clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),username:"chuxuanhy",password:"0936160721",keepalive:10}),s=r.connect("mqtt://tracking.proship.vn:1883",n);s.on("connect",(function(){s.subscribe("PLC/OMRON/STATUS"),s.subscribe("PLC/OMRON/PUB")})),s.on("message",(e,t)=>{switch(e){case"PLC/OMRON/STATUS":return function(e){var t=(e+="").split("|");console.log(t),2===t.length&&(t[1],"Connected"===t[1]&&l.database().ref("Table1/MQTT/STATUS_PLC/"+t[0]).set({Status:"Connected"}),"Disconnected"===t[1]&&l.database().ref("Table1/MQTT/STATUS_PLC/"+t[0]).set({Status:"Disconnected"}))}(t);case"PLC/OMRON/PUB":return function(e){var t=(e+="").split("|");console.log(t),t.length>2&&("BitAdjust"===t[1]&&(getElement=l.database().ref("Table1/BitAdjust").orderByChild("parent").equalTo(t[0]),getElement.once("value",(function(e){e.forEach(e=>{parseInt(e.val().tag)<t.length-2&&(console.log(parseInt(t[parseInt(e.val().tag)+2])),l.database().ref("Table1/BitAdjust").child(e.key).child("status").set(parseInt(t[parseInt(e.val().tag)+2])))})}))),"BitDisplay"===t[1]&&(getElement=l.database().ref("Table1/BitDisplay").orderByChild("parent").equalTo(t[0]),getElement.once("value",(function(e){e.forEach(e=>{parseInt(e.val().tag)<t.length-2&&(console.log(parseInt(t[parseInt(e.val().tag)+2])),l.database().ref("Table1/BitDisplay").child(e.key).child("status").set(parseInt(t[parseInt(e.val().tag)+2])))})}))),"WordAdjust"===t[1]&&(getElement=l.database().ref("Table1/WordAdjust").orderByChild("parent").equalTo(t[0]),getElement.once("value",(function(e){e.forEach(e=>{parseInt(e.val().tag)<t.length-2&&(console.log(parseInt(t[parseInt(e.val().tag)+2])),l.database().ref("Table1/WordAdjust").child(e.key).child("text").set(t[parseInt(e.val().tag)+2]))})}))),"WordDisplay"===t[1]&&(getElement=l.database().ref("Table1/WordDisplay").orderByChild("parent").equalTo(t[0]),getElement.once("value",(function(e){e.forEach(e=>{parseInt(e.val().tag)<t.length-2&&(console.log(parseInt(t[parseInt(e.val().tag)+2])),l.database().ref("Table1/WordDisplay").child(e.key).child("text").set(t[parseInt(e.val().tag)+2]))})}))),"DWordAdjust"===t[1]&&(getElement=l.database().ref("Table1/DWordAdjust").orderByChild("parent").equalTo(t[0]),getElement.once("value",(function(e){e.forEach(e=>{parseInt(e.val().tag)<t.length-2&&(console.log(parseInt(t[parseInt(e.val().tag)+2])),l.database().ref("Table1/DWordAdjust").child(e.key).child("text").set(t[parseInt(e.val().tag)+2]))})}))),"DWordDisplay"===t[1]&&(getElement=l.database().ref("Table1/DWordDisplay").orderByChild("parent").equalTo(t[0]),getElement.once("value",(function(e){e.forEach(e=>{parseInt(e.val().tag)<t.length-2&&(console.log(parseInt(t[parseInt(e.val().tag)+2])),l.database().ref("Table1/DWordDisplay").child(e.key).child("text").set(t[parseInt(e.val().tag)+2]))})}))),"TextField"===t[1]&&(getElement=l.database().ref("Table1/TextField").orderByChild("parent").equalTo(t[0]),getElement.once("value",(function(e){e.forEach(e=>{parseInt(e.val().tag)<t.length-2&&(console.log(t[parseInt(e.val().tag)+2]),l.database().ref("Table1/TextField").child(e.key).child("value").set(t[parseInt(e.val().tag)+2]))})}))))}(t)}console.log("No handle for topic:",e)}),s.on("reconnect",(function(){console.log("reconnect MQTT")}));var o=l.database().ref("Table1/MQTT/SUBSCRIBE_TO_PLC");function i(){var e=new Date,t=e.getHours();t=(t<10?"0":"")+t;var a=e.getMinutes();a=(a<10?"0":"")+a;var l=e.getSeconds();return t+":"+a+":"+(l=(l<10?"0":"")+l)}o.on("value",e=>{if(console.log(e.val().COMPC),"_"!==e.val().COMPC)try{var t=e.val().COMPC.split("|");"BitAdjust"===t[1]&&(s.publish("OMRON/"+t[0]+"/SUB",e.val().COMPC+""),o.child("COMPC").set("_")),"WordAdjust"===t[1]&&(s.publish("OMRON/"+t[0]+"/SUB",e.val().COMPC+""),o.child("COMPC").set("_")),"DWordAdjust"===t[1]&&(s.publish("OMRON/"+t[0]+"/SUB",e.val().COMPC+""),o.child("COMPC").set("_")),"Refresh_BitAdjust"===t[1]&&(s.publish("OMRON/"+t[0]+"/SUBREFRESH",e.val().COMPC+""),o.child("COMPC").set("_")),"Refresh_BitDisplay"===t[1]&&(s.publish("OMRON/"+t[0]+"/SUBREFRESH",e.val().COMPC+""),o.child("COMPC").set("_")),"Refresh_WordAdjust"===t[1]&&(s.publish("OMRON/"+t[0]+"/SUBREFRESH",e.val().COMPC+""),o.child("COMPC").set("_")),"Refresh_WordDisplay"===t[1]&&(s.publish("OMRON/"+t[0]+"/SUBREFRESH",e.val().COMPC+""),o.child("COMPC").set("_")),"Refresh_DWordAdjust"===t[1]&&(s.publish("OMRON/"+t[0]+"/SUBREFRESH",e.val().COMPC+""),o.child("COMPC").set("_")),"Refresh_DWordDisplay"===t[1]&&(s.publish("OMRON/"+t[0]+"/SUBREFRESH",e.val().COMPC+""),o.child("COMPC").set("_"))}catch(e){console.log(e)}}),setInterval((function(){l.database().ref("Table1/MQTT/TIME_CURRENT/").set({Time:i()})}),5e3)},function(e,t){e.exports=require("firebase")},function(e,t){e.exports=require("mqtt")},function(e,t){e.exports=require("url")}]);
//# sourceMappingURL=index.js.map